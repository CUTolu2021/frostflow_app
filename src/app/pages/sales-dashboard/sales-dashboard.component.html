<div class="dashboard-page">
    <!-- Header -->
    <div class="page-header">
        <div>
            <div class="breadcrumb">Overview / Sales</div>
            <h1 class="page-title">Sales Dashboard</h1>
            <p class="page-subtitle">Welcome back, {{ name }}! Ready to record some sales?</p>
        </div>

        <div class="header-actions">
            <!-- Basic Logout for Sales Person -->
            <button class="btn btn-outline" (click)="handleLogout()">
                <span class="material-symbols-outlined">logout</span>
                Logout
            </button>
        </div>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-content">
                <p class="stat-label">Today's Sales</p>
                <h3 class="stat-value">{{ todaySalesMetrics.todaySalesValue | currency: '₦' }}</h3>
                <span class="stat-badge badge-green">Today's Sales</span>
            </div>
            <div class="stat-icon icon-green">
                <span class="material-symbols-outlined">payments</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-content">
                <p class="stat-label">Total Items Sold</p>
                <h3 class="stat-value">{{ salesMetrics.totalUnitsSold }}</h3>
                <span class="stat-badge badge-blue">Volume</span>
            </div>
            <div class="stat-icon icon-blue">
                <span class="material-symbols-outlined">shopping_cart</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-content">
                <p class="stat-label">Stock Count</p>
                <h3 class="stat-value">{{ products.length }}</h3>
                <span class="stat-badge badge-purple">Products</span>
            </div>
            <div class="stat-icon icon-purple">
                <span class="material-symbols-outlined">inventory_2</span>
            </div>
        </div>
    </div>

    <div class="content-grid">
        <!-- Left Column: Daily Sales Recording -->
        <div class="grid-column">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Record Daily Sale</h3>
                </div>
                <div class="card-body">
                    <p class="form-instruction">Select a product and enter the quantity sold.</p>

                    <form [formGroup]="dailySalesForm" (ngSubmit)="onSalesRecordSubmit()" class="vertical-form">
                        <div class="form-group">
                            <label>Product</label>
                            <select formControlName="product_id" class="form-select">
                                <option value="">-- Select Product --</option>
                                <option *ngFor="let p of products" [value]="p.id">{{ p.name }}</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Sold By</label>
                            <select formControlName="unit_type" class="form-select">
                                <option value="kg">Weight (kg)</option>
                                <option value="box">Box / Carton</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Quantity</label>
                            <input type="number" formControlName="quantity" class="form-input" placeholder="e.g. 5"
                                min="0">
                        </div>

                        <div class="form-group">
                            <label>Selling Price ({{ dailySalesForm.value.unit_type === 'box' ? 'per Box' : 'per KG'
                                }})</label>
                            <div class="input-prefix">
                                <span>₦</span>
                                <input type="number" formControlName="unit_price" class="form-input" placeholder="0.00"
                                    min="0">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Payment Method</label>
                            <select formControlName="payment_method" class="form-select">
                                <option value="">-- Select Method --</option>
                                <option *ngFor="let m of paymentMethods" [value]="m">{{ m }}</option>
                            </select>
                        </div>

                        <!-- Hidden Recorded By -->
                        <input type="hidden" formControlName="recorded_by">

                        <button type="submit" class="btn btn-primary full-width" [disabled]="!dailySalesForm.valid">
                            Record Sale
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Right Column: Stock Updates & Overview -->
        <div class="grid-column">
            <!-- Stock Overview -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Current Stock Levels</h3>
                </div>
                <div class="card-body p-0">
                    <div class="stock-list">
                        <div *ngFor="let product of products" class="stock-item">
                            <div class="item-info">
                                <span class="item-name">{{ product.name }}</span>
                            </div>
                            <div class="item-status">
                                <span class="item-meta">{{ product.unit }} units</span>
                                <span class="status-indicator" [class.ok]="(product.unit || 0) > 10"
                                    [class.low]="(product.unit || 0) <= 10"></span>
                            </div>
                        </div>
                        <div *ngIf="products.length === 0" class="empty-state">
                            No stock data available.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>