<div class="dashboard-container">
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <h1>Sales Dashboard</h1>
      <p>Welcome back, {{name}}</p>
    </div>
    <div class="header-right">
      <button class="logout-btn" (click)="handleLogout()">Logout</button>
    </div>
  </header>

  <!-- KPI Cards -->
  <div class="kpi-cards">
    <div class="card kpi-card">
      <div class="card-header">Total Revenue</div>
      <div class="card-body">
        <p class="kpi-value">$12,345</p>
        <p class="kpi-change">+5.2% vs last month</p>
      </div>
    </div>
    <div class="card kpi-card">
      <div class="card-header">Items Sold</div>
      <div class="card-body">
        <p class="kpi-value">678</p>
        <p class="kpi-change">-1.8% vs last month</p>
      </div>
    </div>
    <div class="card kpi-card">
      <div class="card-header">Products in Stock</div>
      <div class="card-body">
        <p class="kpi-value">{{ products.length }}</p>
        <p class="kpi-change">2 new products added</p>
      </div>
    </div>
  </div>
  
<div>
  <!-- Daily Sales Input Section -->
  <div class="card stock-form-card">
      <div class="card-header">
        <h3>Record Daily Sales</h3>
      </div>
      <div class="card-body">
        <p class="form-instruction">Select a product from the dropdown.</p>

        <form [formGroup]="dailySalesForm" (ngSubmit)="onSalesRecordSubmit()">
          <div class="form-group">
            <label for="product">Select a Product:</label>
            <select id="product" formControlName="product_id">
              <option value="">-- Choose a product --</option>
              <option *ngFor="let p of products" [value]="p.id">{{ p.name }}</option>
            </select>
          </div>

          <div class="form-group">
            <label for="quantity">Quantity:</label>
            <input id="quantity" type="number" formControlName="quantity" placeholder="e.g., 50">
          </div>

          <div class="form-group">
            <label for="unitPrice">Selling Price Per kg:</label>
            <input id="unitPrice" type="number" formControlName="unit_price" placeholder="e.g., 3.99">
          </div>

          <div class="form-group">
            <label for="totalPrice">Total Price:</label>
            <input id="totalPrice" type="number" formControlName="total_price" placeholder="e.g., 30.99">
          </div>

          <div class="form-group">
            <label for="paymentMethod">Payment Method:</label>
            <select id="paymentMethod" formControlName="payment_method">
              <option value="">-- Choose a method --</option>
              <option *ngFor="let m of paymentMethods" [value]="m">{{ m }}</option>
            </select>
          </div>

          <input id="recordedBy" type="text" formControlName="recorded_by" value="{{ email }}" hidden>

          <button type="submit" class="submit-btn" [disabled]="!dailySalesForm.valid">Record Sale</button>
        </form>
      </div>
    </div>
</div>

  <!-- Main Content Area -->
  <div class="main-content">
    <!-- Stock Management Section -->
    <div class="card stock-form-card">
      <div class="card-header">
        <h3>Add/Update Stock</h3>
      </div>
      <div class="card-body">
        <p class="form-instruction">To add a new product, type its name. To update, select from the dropdown.</p>

        <form [formGroup]="salesForm" (ngSubmit)="onSubmit()">
          <div class="form-group">
            <label for="existingProduct">Select Existing Product:</label>
            <select id="existingProduct" formControlName="product_id" [disabled]="salesForm.get('name')?.value">
              <option value="">-- Choose to update --</option>
              <option *ngFor="let p of products" [value]="p.id">{{ p.name }}</option>
            </select>
          </div>

          <div class="form-group">
            <label for="productName">New Product Name:</label>
            <input id="productName" type="text" formControlName="name" placeholder="e.g., Vanilla Ice Cream">
          </div>

          <div class="form-group">
            <label for="quantity">Quantity:</label>
            <input id="quantity" type="number" formControlName="quantity" placeholder="e.g., 50">
          </div>

          <div class="form-group">
            <label for="unitPrice">Unit Price:</label>
            <input id="unitPrice" type="number" formControlName="unit_price" placeholder="e.g., 3.99">
          </div>

          <button type="submit" class="submit-btn" [disabled]="!salesForm.valid">Record Stock</button>
        </form>
      </div>
    </div>

    <!-- Stock Overview Section -->
    <div class="card stock-overview-card">
      <div class="card-header">
        <h3>Stock Levels</h3>
      </div>
      <div class="card-body">
        <div class="stock-list">
          @for (product of products; track product.id) {
          <div class="stock-item">
            <span class="product-name">{{ product.name }}</span>
            <span class="product-unit">{{ product.unit }} units</span>
          </div>
          } @empty {
            <p>No products in stock.</p>
          }
        </div>
      </div>
    </div>
  </div>
</div>
